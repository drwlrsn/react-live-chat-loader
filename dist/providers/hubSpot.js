"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.domain = void 0;

var _waitForLoad = _interopRequireDefault(require("../utils/waitForLoad"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const domain = 'js.hs-scripts.com';
exports.domain = domain;

const loadScript = hsId => {
  // Detect the provider is already loaded and return early
  console.debug({
    loadScript: window.HubSpotConversations
  });

  if (window.HubSpotConversations) {
    return false;
  }

  (function loadHubSpotSDK(d, s, id) {
    // fetch customerchat.js
    const fjs = d.getElementsByTagName(s)[0];

    if (d.getElementById(id)) {
      return;
    } //eslint-disable-next-line @typescript-eslint/no-explicit-any


    const js = d.createElement(s);
    js.id = id;
    js.src = `https://${domain}/${hsId}.js`;
    js.type = 'text/javascript';
    js.async = 1;
    js.defer = 1;

    if (fjs) {
      var _fjs$parentNode;

      (_fjs$parentNode = fjs.parentNode) === null || _fjs$parentNode === void 0 ? void 0 : _fjs$parentNode.insertBefore(js, fjs);
    } else {
      d.body.appendChild(js);
    }
  })(window.document, 'script', 'hs-script-loader');

  return true;
};

const load = ({
  providerKey,
  setState,
  beforeInit = () => undefined,
  onReady = () => undefined
}) => {
  window.hsConversationsOnReady = [() => {
    window.HubSpotConversations.widget.load();
    console.debug({
      hsConversationsOnReady: 'ready',
      widgetStatus: window.HubSpotConversations.widget.status()
    });
  }];
  const loaded = loadScript(providerKey);

  if (loaded) {
    beforeInit();
    (0, _waitForLoad.default)(() => {
      var _window$HubSpotConver;

      console.debug({
        waitForLoad: {
          HubSpotConversations: window.HubSpotConversations,
          widget: (_window$HubSpotConver = window.HubSpotConversations) === null || _window$HubSpotConver === void 0 ? void 0 : _window$HubSpotConver.widget
        }
      });
      return Boolean(window.HubSpotConversations && window.HubSpotConversations.widget && window.HubSpotConversations.widget.status().loaded);
    }, // Allow intercom to complete loading before removing fake widget
    () => {
      console.debug({
        loadComplete: window.HubSpotConversations,
        widgetStatus: window.HubSpotConversations.widget.status()
      });
      window.HubSpotConversations.widget.open();
      setState('complete');
      onReady();
      console.debug({
        widgetStatusAfterTimeout: window.HubSpotConversations.widget.status()
      });
    });
  }

  return loaded;
};

const open = () => {
  console.debug({
    open: 'called'
  });
  window.HubSpotConversations && window.HubSpotConversations.widget && !window.HubSpotConversations.widget.status().loaded && window.HubSpotConversations.widget.load();
  return window.HubSpotConversations && window.HubSpotConversations.widget && window.HubSpotConversations.widget.open();
}; // Open provider


const close = () => window.HubSpotConversations.widget.close(); // Close provider


var _default = {
  load,
  open,
  close,
  domain
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm92aWRlcnMvaHViU3BvdC50cyJdLCJuYW1lcyI6WyJkb21haW4iLCJsb2FkU2NyaXB0IiwiaHNJZCIsImNvbnNvbGUiLCJkZWJ1ZyIsIndpbmRvdyIsIkh1YlNwb3RDb252ZXJzYXRpb25zIiwibG9hZEh1YlNwb3RTREsiLCJkIiwicyIsImlkIiwiZmpzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJnZXRFbGVtZW50QnlJZCIsImpzIiwiY3JlYXRlRWxlbWVudCIsInNyYyIsInR5cGUiLCJhc3luYyIsImRlZmVyIiwicGFyZW50Tm9kZSIsImluc2VydEJlZm9yZSIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImRvY3VtZW50IiwibG9hZCIsInByb3ZpZGVyS2V5Iiwic2V0U3RhdGUiLCJiZWZvcmVJbml0IiwidW5kZWZpbmVkIiwib25SZWFkeSIsImhzQ29udmVyc2F0aW9uc09uUmVhZHkiLCJ3aWRnZXQiLCJ3aWRnZXRTdGF0dXMiLCJzdGF0dXMiLCJsb2FkZWQiLCJ3YWl0Rm9yTG9hZCIsIkJvb2xlYW4iLCJsb2FkQ29tcGxldGUiLCJvcGVuIiwid2lkZ2V0U3RhdHVzQWZ0ZXJUaW1lb3V0IiwiY2xvc2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDQTs7OztBQUVPLE1BQU1BLE1BQU0sR0FBRyxtQkFBZjs7O0FBWVAsTUFBTUMsVUFBVSxHQUFJQyxJQUFELElBQWtCO0FBQ25DO0FBQ0FDLEVBQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFjO0FBQUVILElBQUFBLFVBQVUsRUFBRUksTUFBTSxDQUFDQztBQUFyQixHQUFkOztBQUNBLE1BQUlELE1BQU0sQ0FBQ0Msb0JBQVgsRUFBaUM7QUFDL0IsV0FBTyxLQUFQO0FBQ0Q7O0FBQ0QsR0FBQyxTQUFTQyxjQUFULENBQXdCQyxDQUF4QixFQUEyQkMsQ0FBM0IsRUFBOEJDLEVBQTlCLEVBQWtDO0FBQ2pDO0FBQ0EsVUFBTUMsR0FBRyxHQUFHSCxDQUFDLENBQUNJLG9CQUFGLENBQXVCSCxDQUF2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QUFFbkMsTUFBTSxDQUFDQyxvQkFBUCxDQUE0QjBCLE1BQTVCLENBQW1DRSxNQUFuQztBQURkLE9BQWQ7QUFHRCxLQTFCSDtBQTRCRDs7QUFDRCxTQUFPQyxNQUFQO0FBQ0QsQ0F0REQ7O0FBd0RBLE1BQU1JLElBQUksR0FBRyxNQUFlO0FBQzFCcEMsRUFBQUEsT0FBTyxDQUFDQyxLQUFSLENBQWM7QUFBRW1DLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQWQ7QUFDQWxDLEVBQUFBLE1BQU0sQ0FBQ0Msb0JBQVAsSUFDRUQsTUFBTSxDQUFDQyxvQkFBUCxDQUE0QjBCLE1BRDlCLElBRUUsQ0FBQzNCLE1BQU0sQ0FBQ0Msb0JBQVAsQ0FBNEIwQixNQUE1QixDQUFtQ0UsTUFBbkMsR0FBNENDLE1BRi9DLElBR0U5QixNQUFNLENBQUNDLG9CQUFQLENBQTRCMEIsTUFBNUIsQ0FBbUNQLElBQW5DLEVBSEY7QUFLQSxTQUNFcEIsTUFBTSxDQUFDQyxvQkFBUCxJQUNBRCxNQUFNLENBQUNDLG9CQUFQLENBQTRCMEIsTUFENUIsSUFFQTNCLE1BQU0sQ0FBQ0Msb0JBQVAsQ0FBNEIwQixNQUE1QixDQUFtQ08sSUFBbkMsRUFIRjtBQUtELENBWkQsQyxDQVlFOzs7QUFDRixNQUFNRSxLQUFLLEdBQUcsTUFBZXBDLE1BQU0sQ0FBQ0Msb0JBQVAsQ0FBNEIwQixNQUE1QixDQUFtQ1MsS0FBbkMsRUFBN0IsQyxDQUF3RTs7O2VBRXpEO0FBQ2JoQixFQUFBQSxJQURhO0FBRWJjLEVBQUFBLElBRmE7QUFHYkUsRUFBQUEsS0FIYTtBQUliekMsRUFBQUE7QUFKYSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3RhdGUgfSBmcm9tICcuLi90eXBlcydcbmltcG9ydCB3YWl0Rm9yTG9hZCBmcm9tICcuLi91dGlscy93YWl0Rm9yTG9hZCdcblxuZXhwb3J0IGNvbnN0IGRvbWFpbiA9ICdqcy5ocy1zY3JpcHRzLmNvbSdcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgaW50ZXJmYWNlIFdpbmRvdyB7XG4gICAgLy9lc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIEh1YlNwb3RDb252ZXJzYXRpb25zOiBhbnlcbiAgICAvL2VzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgaHNDb252ZXJzYXRpb25zU2V0dGluZ3M6IGFueVxuICAgIC8vZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBoc0NvbnZlcnNhdGlvbnNPblJlYWR5OiBhbnlcbiAgfVxufVxuXG5jb25zdCBsb2FkU2NyaXB0ID0gKGhzSWQ6IHN0cmluZykgPT4ge1xuICAvLyBEZXRlY3QgdGhlIHByb3ZpZGVyIGlzIGFscmVhZHkgbG9hZGVkIGFuZCByZXR1cm4gZWFybHlcbiAgY29uc29sZS5kZWJ1Zyh7IGxvYWRTY3JpcHQ6IHdpbmRvdy5IdWJTcG90Q29udmVyc2F0aW9ucyB9KVxuICBpZiAod2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbiAgKGZ1bmN0aW9uIGxvYWRIdWJTcG90U0RLKGQsIHMsIGlkKSB7XG4gICAgLy8gZmV0Y2ggY3VzdG9tZXJjaGF0LmpzXG4gICAgY29uc3QgZmpzID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShzKVswXVxuICAgIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIC8vZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBjb25zdCBqcyA9IGQuY3JlYXRlRWxlbWVudChzKSBhcyBhbnlcbiAgICBqcy5pZCA9IGlkXG4gICAganMuc3JjID0gYGh0dHBzOi8vJHtkb21haW59LyR7aHNJZH0uanNgXG4gICAganMudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnXG4gICAganMuYXN5bmMgPSAxXG4gICAganMuZGVmZXIgPSAxXG4gICAgaWYgKGZqcykge1xuICAgICAgZmpzLnBhcmVudE5vZGU/Lmluc2VydEJlZm9yZShqcywgZmpzKVxuICAgIH0gZWxzZSB7XG4gICAgICBkLmJvZHkuYXBwZW5kQ2hpbGQoanMpXG4gICAgfVxuICB9KSh3aW5kb3cuZG9jdW1lbnQsICdzY3JpcHQnLCAnaHMtc2NyaXB0LWxvYWRlcicpXG5cbiAgcmV0dXJuIHRydWVcbn1cblxuY29uc3QgbG9hZCA9ICh7XG4gIHByb3ZpZGVyS2V5LFxuICBzZXRTdGF0ZSxcbiAgYmVmb3JlSW5pdCA9ICgpID0+IHVuZGVmaW5lZCxcbiAgb25SZWFkeSA9ICgpID0+IHVuZGVmaW5lZCxcbn06IHtcbiAgcHJvdmlkZXJLZXk6IHN0cmluZ1xuICBzZXRTdGF0ZTogKHN0YXRlOiBTdGF0ZSkgPT4gdm9pZFxuICBiZWZvcmVJbml0PzogKCkgPT4gdm9pZFxuICBvblJlYWR5PzogKCkgPT4gdm9pZFxufSk6IGJvb2xlYW4gPT4ge1xuICB3aW5kb3cuaHNDb252ZXJzYXRpb25zT25SZWFkeSA9IFtcbiAgICAoKSA9PiB7XG4gICAgICB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMud2lkZ2V0LmxvYWQoKVxuICAgICAgY29uc29sZS5kZWJ1Zyh7XG4gICAgICAgIGhzQ29udmVyc2F0aW9uc09uUmVhZHk6ICdyZWFkeScsXG4gICAgICAgIHdpZGdldFN0YXR1czogd2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zLndpZGdldC5zdGF0dXMoKVxuICAgICAgfSlcbiAgICB9XG4gIF1cbiAgY29uc3QgbG9hZGVkID0gbG9hZFNjcmlwdChwcm92aWRlcktleSlcbiAgaWYgKGxvYWRlZCkge1xuICAgIGJlZm9yZUluaXQoKVxuXG4gICAgd2FpdEZvckxvYWQoXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZGVidWcoe1xuICAgICAgICAgIHdhaXRGb3JMb2FkOiB7XG4gICAgICAgICAgICBIdWJTcG90Q29udmVyc2F0aW9uczogd2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zLFxuICAgICAgICAgICAgd2lkZ2V0OiB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnM/LndpZGdldFxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgcmV0dXJuIEJvb2xlYW4oXG4gICAgICAgICAgd2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zICYmXG4gICAgICAgICAgICB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMud2lkZ2V0ICYmXG4gICAgICAgICAgICB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMud2lkZ2V0LnN0YXR1cygpLmxvYWRlZFxuICAgICAgICApXG4gICAgICB9LFxuICAgICAgLy8gQWxsb3cgaW50ZXJjb20gdG8gY29tcGxldGUgbG9hZGluZyBiZWZvcmUgcmVtb3ZpbmcgZmFrZSB3aWRnZXRcbiAgICAgICgpID0+IHtcbiAgICAgICAgY29uc29sZS5kZWJ1Zyh7XG4gICAgICAgICAgbG9hZENvbXBsZXRlOiB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMsXG4gICAgICAgICAgd2lkZ2V0U3RhdHVzOiB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMud2lkZ2V0LnN0YXR1cygpXG4gICAgICAgIH0pXG4gICAgICAgIHdpbmRvdy5IdWJTcG90Q29udmVyc2F0aW9ucy53aWRnZXQub3BlbigpXG4gICAgICAgIHNldFN0YXRlKCdjb21wbGV0ZScpXG4gICAgICAgIG9uUmVhZHkoKVxuICAgICAgICBjb25zb2xlLmRlYnVnKHtcbiAgICAgICAgICB3aWRnZXRTdGF0dXNBZnRlclRpbWVvdXQ6IHdpbmRvdy5IdWJTcG90Q29udmVyc2F0aW9ucy53aWRnZXQuc3RhdHVzKClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICApXG4gIH1cbiAgcmV0dXJuIGxvYWRlZFxufVxuXG5jb25zdCBvcGVuID0gKCk6IHVua25vd24gPT4ge1xuICBjb25zb2xlLmRlYnVnKHsgb3BlbjogJ2NhbGxlZCcgfSlcbiAgd2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zICYmXG4gICAgd2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zLndpZGdldCAmJlxuICAgICF3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMud2lkZ2V0LnN0YXR1cygpLmxvYWRlZCAmJlxuICAgIHdpbmRvdy5IdWJTcG90Q29udmVyc2F0aW9ucy53aWRnZXQubG9hZCgpXG5cbiAgcmV0dXJuIChcbiAgICB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMgJiZcbiAgICB3aW5kb3cuSHViU3BvdENvbnZlcnNhdGlvbnMud2lkZ2V0ICYmXG4gICAgd2luZG93Lkh1YlNwb3RDb252ZXJzYXRpb25zLndpZGdldC5vcGVuKClcbiAgKVxufSAvLyBPcGVuIHByb3ZpZGVyXG5jb25zdCBjbG9zZSA9ICgpOiB1bmtub3duID0+IHdpbmRvdy5IdWJTcG90Q29udmVyc2F0aW9ucy53aWRnZXQuY2xvc2UoKSAvLyBDbG9zZSBwcm92aWRlclxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGxvYWQsXG4gIG9wZW4sXG4gIGNsb3NlLFxuICBkb21haW5cbn1cbiJdfQ==